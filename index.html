<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; padding: 20px; }
    .main-card { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); background: white; }
    .status-badge { background: #e7f3ff; color: #007bff; border-radius: 8px; padding: 5px 12px; font-weight: 600; font-size: 0.85rem; }
    .table thead { background-color: #f8f9fa; }
    .loading-spine { display: flex; justify-content: center; align-items: center; height: 100px; }
  </style>
</head>
<body>

<div class="container max-width-md">
  <div class="main-card p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="fw-bold m-0 text-primary">Jadwal Perpustakaan</h4>
      <div id="lastUpdated" class="text-muted small">Memuat...</div>
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr class="text-muted small uppercase">
            <th>GURU & MAPEL</th>
            <th>WAKTU RESERVASI</th>
          </tr>
        </thead>
        <tbody id="content">
          <tr><td colspan="2" class="text-center p-5">
            <div class="spinner-border text-primary" role="status"></div>
            <div class="mt-2">Sedang sinkronisasi data...</div>
          </td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  window.onload = function() {
    google.script.run
      .withSuccessHandler(renderData)
      .withFailureHandler(function(err) {
        document.getElementById('content').innerHTML = `<tr><td colspan="2" class="text-center text-danger">Gagal memuat data: ${err}</td></tr>`;
      })
      .getDataReservasi();
  };

  function renderData(data) {
    const container = document.getElementById('content');
    const updateLabel = document.getElementById('lastUpdated');
    container.innerHTML = "";
    
    if (typeof data === 'string' && data.startsWith("Error")) {
      container.innerHTML = `<tr><td colspan="2" class="text-center">${data}</td></tr>`;
      return;
    }

    data.forEach(item => {
      const row = `
        <tr>
          <td>
            <div class="fw-bold">${item.nama}</div>
            <div class="text-muted small">${item.mapel}</div>
          </td>
          <td>
            <div class="fw-semibold">${item.tanggal}</div>
            <span class="status-badge">${item.jam}</span>
          </td>
        </tr>`;
      container.innerHTML += row;
    });
    
    updateLabel.innerText = "Terakhir diperbarui: " + new Date().toLocaleTimeString('id-ID');
  }
</script>

</body>
</html>
